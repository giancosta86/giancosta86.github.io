!function(){var t={7797:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IsoDate=void 0;e.IsoDate=class{constructor(t){const[e,o,n]=t.split("-").map(Number);try{if(!e||!o||!n)throw new Error;if(this.unboxed=new Date(e,o-1,n),this.unboxed.getFullYear()!=e||this.unboxed.getMonth()!=o-1||this.unboxed.getDate()!=n)throw new Error}catch(r){throw new Error(`Invalid date string: '${t}'`)}}}},3647:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compareSubjects=e.Subject=void 0;const n=o(9239);class r{constructor(t,e){if(this.name=t,this.items=e,!t)throw new Error("Empty subject name");if(!e.length)throw new Error(`Cannot create subject '${t}' with no items`);this.totalMinutes=e.reduce(((t,e)=>t+e.totalMinutes),0),this.containsSubjects=e[0]instanceof r,this.containsSubjects||function(t){const e=new Set;for(const o of t){if(e.has(o.key))throw new Error(`Duplicate work: '${o.title}'`);e.add(o.key)}}(e)}}e.Subject=r,e.compareSubjects=function(t,e){const o=e.totalMinutes-t.totalMinutes;return o||t.name.localeCompare(e.name,n.defaultLocale)}},8654:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Taxonomy=void 0;e.Taxonomy=class{constructor(t,e){if(this.name=t,this.items=e,this.containsSubjects=!0,!t)throw new Error("Empty taxonomy name");if(!e.length)throw new Error(`Cannot create taxonomy '${t}' with no subjects`);this.totalMinutes=e.reduce(((t,e)=>t+e.totalMinutes),0)}}},3862:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMeaningful=void 0,e.isMeaningful=function(t){return!t.containsSubjects||t.items.length>=2}},7069:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TaxonomyPath=void 0;const n=o(3862);class r{constructor(t){this.levels=t,this.currentLevel=t[t.length-1],this.previousLevels=this.levels.slice(0,t.length-1),this.subjectsInPreviousLevels=this.previousLevels.reduce(((t,e)=>t+e.items.length),0)}static fromTaxonomy(t){return new r([t])}push(t){if(!this.currentLevel.items.includes(t))throw new Error(`Cannot push subject '${t.name}' not belonging to the current level of the path`);return new r([...this.levels,t])}revertTo(t){const e=this.findLevelIndex(t),o=this.levels.slice(0,e+1);return new r(o)}findLevelIndex(t){const e=this.levels.indexOf(t);if(e<0)throw new Error(`Cannot find level '${t.name}' not belonging to the path`);return e}toMeaningful(){return(0,n.isMeaningful)(this.currentLevel)?this:this.push(this.currentLevel.items[0]).toMeaningful()}navigateTaxonomy(t){const e=[t];let o=t;for(const n of this.levels.slice(1)){if(!o.containsSubjects)break;const t=o.items.find((t=>t.name==n.name));if(!t)break;e.push(t),o=t}return new r(e)}}e.TaxonomyPath=r},9540:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compareWorks=e.Work=void 0;const n=o(9239);e.Work=class{constructor(t,e,o){if(this.title=t,this.totalMinutes=e,!t)throw new Error("Empty work title");if(e<=0)throw new Error(`Invalid total minutes for work '${t}'`);this.completionDate=null===o||void 0===o?void 0:o.completionDate,this.kind=null===o||void 0===o?void 0:o.kind,this.url=null===o||void 0===o?void 0:o.url,this.certificateUrl=null===o||void 0===o?void 0:o.certificateUrl,this.key=this.completionDate?`${t} # ${this.completionDate.unboxed.getTime()} # ${e}`:t}},e.compareWorks=function(t,e){if(!t.completionDate||!e.completionDate){if(e.completionDate)return-1;if(t.completionDate)return 1;const o=e.totalMinutes-t.totalMinutes;return o||t.title.localeCompare(e.title,n.defaultLocale)}const o=e.completionDate.unboxed.getTime()-t.completionDate.unboxed.getTime();return o||t.title.localeCompare(e.title,n.defaultLocale)}},9239:function(t,e){"use strict";function o(t){return`${t} hour${1==t?"":"s"}`}function n(t){return`${t} minute${1==t?"":"s"}`}Object.defineProperty(e,"__esModule",{value:!0}),e.formatError=e.formatDate=e.formatDuration=e.defaultLocale=void 0,e.defaultLocale="en",e.formatDuration=function(t){if(t<0)throw new Error(`Invalid total minutes: ${t}`);const e=Math.floor(t/60),r=t%60;return e?r?`${o(e)}, ${n(r)}`:o(e):n(r)},e.formatDate=function(t){return t.unboxed.toLocaleString(e.defaultLocale,{day:"numeric",month:"long",year:"numeric"})},e.formatError=function(t){return t instanceof Error?t.message:String(t)}},3398:function(t,e,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(e,o);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,n,r)}:function(t,e,o,n){void 0===n&&(n=o),t[n]=e[o]}),r=this&&this.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||n(e,t,o)};Object.defineProperty(e,"__esModule",{value:!0}),r(o(5307),e),r(o(9239),e),r(o(7797),e),r(o(3647),e),r(o(8654),e),r(o(3862),e),r(o(7069),e),r(o(9540),e)},5307:function(t,e,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(e,o);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,n,r)}:function(t,e,o,n){void 0===n&&(n=o),t[n]=e[o]}),r=this&&this.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||n(e,t,o)};Object.defineProperty(e,"__esModule",{value:!0}),r(o(4648),e),r(o(8414),e)},8414:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toTaxonomy=void 0;const n=o(8654),r=o(3647),i=o(7797),s=o(9540);function a(t){return Object.entries(t).flatMap((([t,e])=>{const o=function(t,e){const o=e instanceof Array?(n=e,n.map(c).sort(s.compareWorks)):a(e);var n;return o.length?new r.Subject(t,o):null}(t,e);return o?[o]:[]})).sort(r.compareSubjects)}function c(t){if(null==t.title)throw new Error(`Missing work title: ${JSON.stringify(t)}`);const e=String(t.title);if(null==t.minutes)throw new Error(`Missing 'minutes' field in work '${e}'`);const o=Math.round(Number(t.minutes));if(isNaN(o))throw new Error(`'minutes' field in work '${e}' is not a number`);const n=t.completionDate?new i.IsoDate(String(t.completionDate)):void 0;return new s.Work(e,o,{kind:t.kind?String(t.kind):void 0,completionDate:n,url:t.url?String(t.url):void 0,certificateUrl:t.certificateUrl?String(t.certificateUrl):void 0})}e.toTaxonomy=function(t,e){const o=a(e);return new n.Taxonomy(t,o)}},5494:function(t,e){"use strict";var o=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function s(t){try{c(n.next(t))}catch(e){i(e)}}function a(t){try{c(n.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.CachingTaxonomyRepository=void 0;e.CachingTaxonomyRepository=class{constructor(t){this.targetRepository=t,this.taxonomyCache=new Map}getByKey(t){return o(this,void 0,void 0,(function*(){const e=this.taxonomyCache.get(t);if(e)return Promise.resolve(e);const o=yield this.targetRepository.getByKey(t);return this.taxonomyCache.set(t,o),o}))}}},9697:function(t,e,o){"use strict";var n=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function s(t){try{c(n.next(t))}catch(e){i(e)}}function a(t){try{c(n.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.FetchingTaxonomyRepository=void 0;const r=o(8414);e.FetchingTaxonomyRepository=class{constructor(t,e=r.toTaxonomy){this.rawTaxonomyFetcher=t,this.taxonomyReifier=e}getByKey(t){return n(this,void 0,void 0,(function*(){const e=yield this.rawTaxonomyFetcher(t.id);return this.taxonomyReifier(t.name,e)}))}}},5208:function(t,e){"use strict";function o(t,e){const o=new Set;t.forEach((t=>{const n=t[e];if(null==n||""===n)throw new Error(`Taxonomy key with empty/missing ${e}: ${JSON.stringify(t)}`);if("string"!=typeof n)throw new Error(`Taxonomy key ${e} '${n}' is not a string`);if(o.has(n))throw new Error(`Duplicate taxonomy key ${e}: '${n}'`);o.add(n)}))}Object.defineProperty(e,"__esModule",{value:!0}),e.validateTaxonomyKeys=void 0,e.validateTaxonomyKeys=function(t){if(!t.length)throw new Error("Empty taxonomy key array!");o(t,"id"),o(t,"name")}},6904:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},4648:function(t,e,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(e,o);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,n,r)}:function(t,e,o,n){void 0===n&&(n=o),t[n]=e[o]}),r=this&&this.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||n(e,t,o)};Object.defineProperty(e,"__esModule",{value:!0}),r(o(5494),e),r(o(9697),e),r(o(5208),e),r(o(6904),e)}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}},s=!0;try{t[n].call(i.exports,i,i.exports,o),s=!1}finally{s&&delete e[n]}return i.exports}var n={};!function(){"use strict";const t=o(3398);self.addEventListener("message",(e=>{const o=e.data;"computeTaxonomy"!==o.type||function({correlationId:e,taxonomyName:o,rawTaxonomy:n}){try{const r={type:"taxonomyReady",correlationId:e,taxonomy:(0,t.toTaxonomy)(o,n)};self.postMessage(r)}catch(r){const t={type:"taxonomyError",correlationId:e,errorMessage:r instanceof Error?r.message:String(r)};self.postMessage(t)}}(o)}))}(),_N_E=n}();